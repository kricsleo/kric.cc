<button id="theme" class="i-carbon:sun dark:i-carbon:moon nav-link!" title="toggle theme" />

<script is:inline>
  init()
  document.addEventListener('astro:after-swap', init)

  function init() {
    updateTheme(queryTheme())
    document.getElementById("theme").addEventListener("click", () => {
      const nextTheme = queryTheme() === "dark" ? "light" : "dark"
      localStorage.setItem('color-scheme', nextTheme)
      updateTheme(nextTheme)
    })
  }

  function queryTheme() {
    return localStorage.getItem('color-scheme') 
      || (window.matchMedia("(prefers-color-scheme: dark)").matches ? 'dark' : 'light')
  }
  function updateTheme(theme) {
    theme === "dark"
      ? document.documentElement.classList.add("dark")
      : document.documentElement.classList.remove("dark")
  }
</script>